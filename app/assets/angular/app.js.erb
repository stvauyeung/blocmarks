blocMarks = angular.module('blocMarks', ['ui.router', 'blocMarksControllers', 'blocMarksDirectives', 'blocMarksServices', 'ngCookies', 'ngResource','userModel']);

blocMarks.config(['$stateProvider', '$locationProvider', '$httpProvider', function($stateProvider, $locationProvider, $httpProvider) {
  $locationProvider.html5Mode(true);
  $httpProvider.defaults.headers.common['X-CSRF-Token'] = $('meta[name=csrf-token]').attr('content');
  $stateProvider
    .state('landing', {
      url: '/',
      views: {
        'nav@': {
          controller: 'NavCtrl',
          templateUrl: '<%= asset_path("templates/nav-bar.html.erb") %>',
          resolve: {
            signedIn: ['User', '$cookies', function(User, $cookies) {
              if ($cookies.user) {
                return true;
              } else {
                return false;
              };
            }]
          }
        },
        'main@': {
          templateUrl: '<%= asset_path("templates/landing.html") %>'
        }
      }
    })
    .state('newUser', {
      url: '/users/new',
      views: {   
        'nav@': {
          controller: 'NavCtrl',
          templateUrl: '<%= asset_path("templates/nav-bar.html.erb") %>',
          resolve: {
            signedIn: ['User', '$cookies', function(User, $cookies) {
              if ($cookies.user) {
                return true;
              } else {
                return false;
              };
            }]
          }
        },
        'main@': {
          controller: 'UsersCtrl',
          templateUrl: '<%= asset_path("templates/new-user.html") %>'
        }
      }
    })
    .state('newSession', {
      url: '/login',
      views: {
        'nav@': {
          controller: 'NavCtrl',
          templateUrl: '<%= asset_path("templates/nav-bar.html.erb") %>',
          resolve: {
            signedIn: ['User', '$cookies', function(User, $cookies) {
              if ($cookies.user) {
                return true;
              } else {
                return false;
              };
            }]
          }
        },
        'main@': {
          controller: 'SessionsCtrl',
          templateUrl: '<%= asset_path("templates/login.html") %>'
        }
      }
    })
    .state('userHome', {
      url: '/home',
      views: {
        'nav@': {
          controller: 'NavCtrl',
          templateUrl: '<%= asset_path("templates/nav-bar.html.erb") %>',
          resolve: {
            signedIn: ['User', '$cookies', function(User, $cookies) {
              if ($cookies.user) {
                return true;
              } else {
                return false;
              };
            }]
          }
        },
        'main@': {
          controller: 'UserHomeCtrl',
          templateUrl: '<%= asset_path("templates/user-home.html") %>',
          resolve: {
            currentUser: ['User', '$cookies', function(User, $cookies) {
              user = User.get($cookies.user);
              console.log(user);
              return user;
            }]
          }
        }
      }
    })
    .state('newBookmark', {
      url: '/add',
      views: {
        'nav@': {
          controller: 'NavCtrl',
          templateUrl: '<%= asset_path("templates/nav-bar.html.erb") %>',
          resolve: {
            signedIn: ['User', '$cookies', function(User, $cookies) {
              if ($cookies.user) {
                return true;
              } else {
                return false;
              };
            }]
          }
        },
        'main@': {
          controller: 'BookmarksCtrl',
          templateUrl: '<%= asset_path("templates/new-bookmark.html") %>'
        }
      }
    });
}]);